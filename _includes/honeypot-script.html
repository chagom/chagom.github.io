<!-- _includes/honeypot-script.html -->
<script>
(function(){
  const LOGGER_URL = "https://your-serverless.example.com/api/log-bot";

  const hp = document.getElementById('hp-link');
  if (!hp) return;

  let sent = false;

  function report(info) {
    if (sent) return;
    sent = true;

    try {
      const payload = JSON.stringify(info);
      if (navigator.sendBeacon && LOGGER_URL) {
        const blob = new Blob([payload], { type: 'application/json' });
        navigator.sendBeacon(LOGGER_URL, blob);
      } else if (LOGGER_URL) {
        // fallback fetch
        fetch(LOGGER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: payload,
          keepalive: true
        }).catch(()=>{/* ignore */});
      }
    } catch(e){}

    try {
      if (typeof gtag === 'function') {
        gtag('event','bot_detected',{
          method: 'honeypot',
          event_category: 'bot',
          non_interaction: true
        });
      }
    } catch(e){}
  }

  hp.addEventListener('click', function(e){
    e.preventDefault();
    report({type: 'click', url: location.href, ua: navigator.userAgent});
  }, {capture:true, passive:true});

  hp.addEventListener('mouseover', function(){
    report({type: 'mouseover', url: location.href, ua: navigator.userAgent});
  }, {capture:true, passive:true});

  (function checkTrapPath(){
    fetch('/bot-trap', { method: 'HEAD', cache: 'no-store' }).catch(()=>{});
  })();

})();
</script>